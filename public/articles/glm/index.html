<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Generalized Linear model - tidypredict</title>
    <meta name="generator" content="Hugo 0.29" />

    
    <meta name="description" content="Parses a model to create a predict routine with Tidy Eval.">
    
    <link rel="canonical" href="/articles/glm/">
    
    <meta name="author" content="Edgar Ruiz">
    

    <meta property="og:url" content="/articles/glm/">
    <meta property="og:title" content="tidypredict">
    <meta property="og:image" content="/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="tidypredict">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/fonts/icon.eot');
        src: url('/fonts/icon.eot')
               format('embedded-opentype'),
             url('/fonts/icon.woff')
               format('woff'),
             url('/fonts/icon.ttf')
               format('truetype'),
             url('/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="/stylesheets/application.css">
    <link rel="stylesheet" href="/stylesheets/temporary.css">
    <link rel="stylesheet" href="/stylesheets/palettes.css">
    <link rel="stylesheet" href="/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-teal palette-accent-blue">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        tidypredict - Generalized Linear model
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/theotheredgar" title="@theotheredgar on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/edgararuiz" title="@edgararuiz on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/edgararuiz/tidypredict" class="project">
    <div class="banner">
      <div class="name">
        <strong>tidypredict <span class="version">0.0.0.9001</span></strong>
        
          <br>
          edgararuiz/tidypredict
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul>
          <li>
            <p>
              
              <a href="https://travis-ci.org/edgararuiz/tidypredict">
                <img src="https://travis-ci.org/edgararuiz/tidypredict.svg?branch=master" alt="Build Status" />
              </a>
              
            </p>

          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Home" href="/">
	
	Home
</a>



  
</li>



<li>
  
    



<a  title="Reference" href="/reference/">
	
	Reference
</a>



  
</li>



<li>
  
    <span class="section">Articles</span>
    <ul>
      
        
        



<a  title="Linear Regression model" href="/articles/lm/">
	
	Linear Regression model
</a>



      
        
        



<a class="current" title="Generalized Linear model" href="/articles/glm/">
	
	Generalized Linear model
</a>


<ul id="scrollspy">
</ul>


      
        
        



<a  title="Random Forest model" href="/articles/randomforest/">
	
	Random Forest model
</a>



      
        
        



<a  title="Database write-back" href="/articles/sql/">
	
	Database write-back
</a>



      
    </ul>
  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/theotheredgar" target="_blank" title="@theotheredgar on Twitter">
              @theotheredgar on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/edgararuiz" target="_blank" title="@edgararuiz on GitHub">
              @edgararuiz on GitHub
            </a>
          </li>
          

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Generalized Linear model </h1>

			<div id="highlights-limitations" class="section level2">
<h2>Highlights &amp; Limitations</h2>
<ul>
<li>Defaults to 0-to-1 predictions for <code>binomial</code> family models. That is akin to running <code>predict(model, type = &quot;response&quot;)</code></li>
<li>Only <em>treatment</em> contrast (<code>contr.treatment</code>) are supported.</li>
<li><code>offset</code> is supported</li>
<li>Categorical variables are supported</li>
<li>In-line functions in the formulas are <strong>not supported</strong>:
<ul>
<li>OK - <code>wt ~ mpg + am</code></li>
<li>OK - <code>mutate(mtcars, newam = paste0(am))</code> and then <code>wt ~ mpg + newam</code></li>
<li>Not OK - <code>wt ~ mpg + as.factor(am)</code></li>
<li>Not OK - <code>wt ~ mpg + as.character(am)</code></li>
</ul></li>
<li>Interval functions are not supported: <code>tidypredict_interval()</code> &amp; <code>tidypredict_sql_interval()</code></li>
</ul>
</div>
<div id="how-it-works" class="section level2">
<h2>How it works</h2>
<pre class="r"><code>df &lt;- mtcars %&gt;%
  mutate(char_cyl = paste0(&quot;cyl&quot;, cyl)) %&gt;%
  select(wt, char_cyl, am) 

model &lt;- glm(am ~ wt + char_cyl, data = df, family = &quot;binomial&quot;)</code></pre>
<p>It returns a SQL query that contains the coefficients (<code>model$coefficients</code>) operated against the correct variable or categorical variable value. In most cases the resulting SQL is one short <code>CASE WHEN</code> statement per coefficient. It appends the <code>offset</code> field or value, if one is provided.</p>
<p>For <code>binomial</code> models, the <a href="https://en.wikipedia.org/wiki/Sigmoid_function">sigmoid</a> equation is applied. This means that the target SQL database type will need to support the exponent function.</p>
<pre class="r"><code>library(tidypredict)

tidypredict_sql(model, dbplyr::simulate_mssql())</code></pre>
<pre><code>## &lt;SQL&gt; EXP((((CASE WHEN (((`char_cyl`) = (&#39;cyl6&#39;)) =  &#39;TRUE&#39;) THEN ((3.10462643177453)) WHEN (((`char_cyl`) = (&#39;cyl6&#39;)) =  &#39;FALSE&#39;) THEN (0.0) END) + (CASE WHEN (((`char_cyl`) = (&#39;cyl8&#39;)) =  &#39;TRUE&#39;) THEN ((5.37942092366097)) WHEN (((`char_cyl`) = (&#39;cyl8&#39;)) =  &#39;FALSE&#39;) THEN (0.0) END)) + ((`wt`) * (-7.85934263583835))) + (20.8527831345691)) / (EXP((((CASE WHEN (((`char_cyl`) = (&#39;cyl6&#39;)) =  &#39;TRUE&#39;) THEN ((3.10462643177453)) WHEN (((`char_cyl`) = (&#39;cyl6&#39;)) =  &#39;FALSE&#39;) THEN (0.0) END) + (CASE WHEN (((`char_cyl`) = (&#39;cyl8&#39;)) =  &#39;TRUE&#39;) THEN ((5.37942092366097)) WHEN (((`char_cyl`) = (&#39;cyl8&#39;)) =  &#39;FALSE&#39;) THEN (0.0) END)) + ((`wt`) * (-7.85934263583835))) + (20.8527831345691)) + 1.0)</code></pre>
<p>Alternatively, use <code>tidypredict_to_column()</code> if the results are the be used or previewed in <code>dplyr</code>.</p>
<pre class="r"><code>df %&gt;%
  tidypredict_to_column(model) %&gt;%
  head(10) </code></pre>
<pre><code>##       wt char_cyl am        fit
## 1  2.620     cyl6  1 0.96662269
## 2  2.875     cyl6  1 0.79605201
## 3  2.320     cyl4  1 0.93208127
## 4  3.215     cyl6  0 0.21242376
## 5  3.440     cyl8  0 0.30918450
## 6  3.460     cyl6  0 0.03783629
## 7  3.570     cyl8  0 0.13875740
## 8  3.190     cyl4  0 0.01450687
## 9  3.150     cyl4  0 0.01975984
## 10 3.440     cyl6  0 0.04399324</code></pre>
</div>
<div id="under-the-hood" class="section level2">
<h2>Under the hood</h2>
<p>The parser reads several parts of the <code>glm</code> object to tabulate all of the needed variables. One entry per coefficient is added to the final table. Other variables are added at the end. Some variables are not required for every parsed model. For example, <code>offset</code> is listed because it’s part of the formula (call) of the model, if there were no offset in a given model, that line would not exist.</p>
<pre class="r"><code>parse_model(model)</code></pre>
<pre><code>## # A tibble: 8 x 8
##   labels      vals     type        estimate    qr_1   qr_2    qr_3   qr_4
##   &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 (Intercept) &quot;&quot;       intercept      20.9  - 0.679 - 5.11 - 1.15    6.05
## 2 wt          &quot;&quot;       continuous    - 7.86   0       1.62   0.232 - 2.58
## 3 char_cyl    cyl6     categorical     3.10   0       0      1.56    1.86
## 4 char_cyl    cyl8     categorical     5.38   0       0      0       3.20
## 5 model       glm      variable       NA     NA      NA     NA      NA   
## 6 residual    28       variable       NA     NA      NA     NA      NA   
## 7 family      binomial variable       NA     NA      NA     NA      NA   
## 8 link        logit    variable       NA     NA      NA     NA      NA</code></pre>
<p>The output from <code>parse_model()</code> is transformed into a <code>dplyr</code>, a.k.a Tidy Eval, formula. All categorical variables are operated using <code>if_else()</code>.</p>
<pre class="r"><code>tidypredict_fit(model)</code></pre>
<pre><code>## exp((((ifelse((char_cyl) == (&quot;cyl6&quot;), (3.10462643177453), 0)) + 
##     (ifelse((char_cyl) == (&quot;cyl8&quot;), (5.37942092366097), 0))) + 
##     ((wt) * (-7.85934263583835))) + (20.8527831345691))/(exp((((ifelse((char_cyl) == 
##     (&quot;cyl6&quot;), (3.10462643177453), 0)) + (ifelse((char_cyl) == 
##     (&quot;cyl8&quot;), (5.37942092366097), 0))) + ((wt) * (-7.85934263583835))) + 
##     (20.8527831345691)) + 1)</code></pre>
<p>From there, the Tidy Eval formula can be used anywhere where it can be operated. <code>tidypredict</code> provides three paths:</p>
<ul>
<li>Use directly inside <code>dplyr</code>, <code>mutate(df, !! tidypredict_fit(model))</code></li>
<li>Use <code>tidypredict_to_column(model)</code> to a piped command set</li>
<li>Use <code>tidypredict_to_sql(model)</code> to retrieve the SQL statement</li>
</ul>
<p>The same applies to the prediction interval functions.</p>
</div>
<div id="how-it-performs" class="section level2">
<h2>How it performs</h2>
<p>Testing the <code>tidypredict</code> results is easy. The <code>tidypredict_test()</code> function automatically uses the <code>lm</code> model object’s data frame, to compare <code>tidypredict_fit()</code>, and <code>tidypredict_interval()</code> to the results given by <code>predict()</code></p>
<pre class="r"><code>tidypredict_test(model)</code></pre>
<pre><code>## tidypredict test results
## Difference threshold: 1e-12
## 
##  All results are within the difference threshold</code></pre>
</div>


			<aside class="copyright" role="note">
				
				&copy; 2018 Released under the GPL-3 license &ndash;
				
				Documentation built with
				<a href="https://github.com/r-lib/pkgdown/">pkgdown</a>,
				<a href="https://github.com/rstudio/blogdown">blogdown</a>, and 
				<a href="https://www.gohugo.io" target="_blank"> Hugo</a> using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
				
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="/reference/" title="Function Reference">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Function Reference
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="/articles/lm/" title="Linear Regression model">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Linear Regression model
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

Skip to content
This repository
Search
Pull requests
Issues
Marketplace
Explore
 @edgararuiz
 Sign out
 Unwatch 9
  Star 5  Fork 5 rstudio/db.rstudio.com
 Code  Issues 6  Pull requests 0  Projects 0  Wiki  Insights  Settings
Tree: 7a7548589f Find file Copy pathdb.rstudio.com/themes/hugo-material-docs/layouts/partials/footer_js.html
7a75485  on Apr 22, 2017
@edgararuiz edgararuiz Fix to theme's scrollspy
1 contributor
RawBlameHistory      
84 lines (73 sloc)  2.83 KB
    <script>
    
      var base_url = '\/';
      var repo_id  = 'edgararuiz\/tidypredict';
    
    </script>

    <script src="/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("div");
      var scrollspy = document.getElementById('scrollspy');
      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            if(headers[i].id.length > 0){
              var li = document.createElement("li");
              li.setAttribute("class", "anchor");
  
              var a  = document.createElement("a");
              a.setAttribute("href", "#" + headers[i].id);
              a.setAttribute("title", headers[i].innerHTML);
              a.innerHTML = headers[i].getElementsByTagName("h2")[0].innerHTML;
  
              li.appendChild(a)
              scrollspy.appendChild(li);
            }            
            
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
© 2018 GitHub, Inc.
Terms
Privacy
Security
Status
Help
Contact GitHub
API
Training
Shop
Blog
About
